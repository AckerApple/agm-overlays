{"version":3,"file":"agm-overlays.js","sources":["ng://agm-overlays/AgmOverlay.component.ts","ng://agm-overlays/AgmOverlays.module.ts","ng://agm-overlays/agm-overlays.ts"],"sourcesContent":["import { Subscription } from \"rxjs\"\n\nimport {\n  Input, Component, Output, EventEmitter,\n  TemplateRef, ViewChild, ElementRef, QueryList,\n  ContentChildren\n} from \"@angular/core\"\n\nimport {\n  AgmInfoWindow, LatLngBounds, LatLng, MarkerManager,\n  GoogleMapsAPIWrapper, AgmMarker\n} from \"@agm/core\"\n\nimport { GoogleMap } from \"@agm/core/services/google-maps-types\"\ndeclare var google: any\n\nexport interface latLng{\n  latitude  : number\n  longitude : number\n}\n\nexport interface bounds{\n  x: latLng//relative adjustment mathematics\n  y: latLng//relative adjustment mathematics\n} \n\nexport interface latLngPlus{\n  latitude  : number\n  longitude : number\n  bounds?   : bounds\n}\n\n@Component({\n  selector:\"agm-overlay\",\n  template:'<div #content><div style=\"position:absolute\"><ng-content></ng-content></div></div>'\n}) export class AgmOverlay{\n  @Input() latitude:number\n  @Input() longitude:number\n  \n  @Input() visible: boolean = true//possibly doesn't work and just left over from agm-core marker replication\n  @Input() zIndex: number = 1\n  @Input() bounds:bounds\n  \n  //TIP: Do NOT use this... Just put (click) on your html overlay element\n  @Output() markerClick: EventEmitter<void> = new EventEmitter<void>()\n  \n  @Input() openInfoWindow: boolean = true\n  @ContentChildren(AgmInfoWindow) infoWindow: QueryList<AgmInfoWindow> = new QueryList<AgmInfoWindow>()\n\n  //TODO, implement this\n  @Input('markerDraggable') draggable: boolean = false\n\n  @ViewChild('content', { read: ElementRef }) template: ElementRef\n\n  destroyed:boolean\n  overlayView:any\n  //elmGuts:any\n  private _observableSubscriptions: Subscription[] = []\n\n  constructor(\n    protected _mapsWrapper: GoogleMapsAPIWrapper,\n    private _markerManager: MarkerManager//rename to fight the private declaration of parent\n  ){}\n\n  ngAfterViewInit(){\n    //remove reference of info windows\n    const iWins = this.template.nativeElement.getElementsByTagName('agm-info-window')\n    for(let x=iWins.length-1; x >= 0; --x){\n      iWins[x].parentNode.removeChild(iWins[x])\n    }\n\n    this.load().then(()=>{\n      this.onChanges = this.onChangesOverride\n    })\n  }\n  \n  ngAfterContentInit() {\n    this.infoWindow.changes.subscribe(() => this.handleInfoWindowUpdate());\n  }\n\n  ngOnChanges( changes ){\n    this.onChanges(changes)\n  }\n\n  onChanges( changes ){}\n\n  onChangesOverride( changes ){\n    if( changes.latitude || changes.longitude || changes.zIndex ){\n      this.overlayView.latitude = this.latitude\n      this.overlayView.longitude = this.longitude\n      this.overlayView.zIndex = this.zIndex\n      this.destroy().then(()=>this.load())\n    }\n  }\n\n  ngOnDestroy(){\n    this.destroy()\n  }\n\n  destroy():Promise<any>{\n    this.destroyed = true\n\n    const promise = this._markerManager.deleteMarker( this.overlayView )\n    \n    if( this.overlayView ){\n      if( this.overlayView.div ){\n        this.overlayView.remove()\n      }\n      this.overlayView.setMap(null)\n    }\n    \n    this._observableSubscriptions.forEach((s) => s.unsubscribe())\n    \n    delete this.overlayView\n    //delete this.elmGuts\n\n    return promise\n  }\n  \n  private handleInfoWindowUpdate() {\n    if (this.infoWindow.length > 1) {\n      throw new Error('Expected no more than one info window.');\n    }\n    \n    this.infoWindow.forEach(iWin => {\n      iWin.hostMarker = <any>this.overlayView\n    });\n  }\n\n  load():Promise<void>{\n    return this._mapsWrapper.getNativeMap()\n    .then(map=>{\n      const overlay = this.getOverlay( map )\n\n      this._markerManager.addMarker( <any>overlay )\n      this._addEventListeners()\n\n      return this._markerManager.getNativeMarker( overlay )\n    })\n    .then(nativeMarker=>{\n      const setMap = nativeMarker.setMap\n      if( nativeMarker['map'] ){\n        this.overlayView.setMap( nativeMarker['map'] )\n      }\n\n      nativeMarker.setMap = (map)=>{\n        setMap.call(nativeMarker,map)\n\n        if( this.overlayView ){\n          this.overlayView.setMap(map)\n        }\n      }\n    })\n  }\n\n  getOverlay( map ){\n    this.overlayView = this.overlayView || new google.maps.OverlayView()\n\n    /* make into foo marker that AGM likes */\n      this.overlayView.iconUrl = \" \"\n      this.overlayView.latitude = this.latitude\n      this.overlayView.longitude = this.longitude\n      this.overlayView.visible = false//hide 40x40 transparent placeholder that prevents hover events\n    /* end */\n\n    if( this.bounds ){\n      this.overlayView.bounds_ = new google.maps.LatLngBounds(\n        new google.maps.LatLng(\n          this.latitude + this.bounds.x.latitude,\n          this.longitude + this.bounds.x.longitude\n        ),\n        new google.maps.LatLng(\n          this.latitude + this.bounds.y.latitude,\n          this.longitude + this.bounds.y.longitude\n        )\n      )\n    }\n\n    // js-marker-clusterer does not support updating positions. We are forced to delete/add and compensate for .removeChild calls\n    const elm = this.template.nativeElement.children[0]\n    //const elm =  this.elmGuts || this.template.nativeElement.children[0]\n\n    //we must always be sure to steal our stolen element back incase we are just in middle of changes and will redraw\n    const restore = (div)=>{\n      this.template.nativeElement.appendChild( div )\n    }\n\n    this.overlayView.remove = function(){\n      if(!this.div)return\n      this.div.parentNode.removeChild(this.div);\n      restore( this.div )\n      delete this.div\n    }\n\n    this.overlayView.getDiv = function(){\n      return this.div\n    }\n\n    this.overlayView.draw = function(){\n      if ( !this.div ) {\n        this.div = elm\n        const panes = this.getPanes()\n        // if no panes then assumed not on map\n        if(!panes || !panes.overlayImage)return\n\n        panes.overlayImage.appendChild( elm )\n      }\n\n      const latlng = new google.maps.LatLng(this.latitude,this.longitude)\n\n      const proj = this.getProjection()\n      if(!proj)return\n\n      const point = proj.fromLatLngToDivPixel( latlng )\n\n      if (point) {\n        elm.style.left = (point.x - 10) + 'px'\n        elm.style.top = (point.y - 20) + 'px'\n      }        \n\n      if( this.bounds_ ){\n        // stretch content between two points leftbottom and righttop and resize\n        const proj = this.getProjection()\n        const sw = proj.fromLatLngToDivPixel(this.bounds_.getSouthWest())\n        const ne = proj.fromLatLngToDivPixel(this.bounds_.getNorthEast())\n  \n        this.div.style.left = sw.x + 'px'\n        this.div.style.top = ne.y + 'px'\n        this.div.children[0].style.width = ne.x - sw.x + 'px'\n        this.div.children[0].style.height = sw.y - ne.y + 'px'\n      }\n    }\n\n    elm.addEventListener(\"click\", event=>{\n      this.handleTap()\n      event.stopPropagation()\n    })\n\n    this.handleInfoWindowUpdate()\n\n    return this.overlayView\n  }\n\n  handleTap(){\n    if (this.openInfoWindow) {\n      this.infoWindow.forEach(infoWindow=>{\n        infoWindow.open()\n      })\n    }\n    this.markerClick.emit(null);\n  }\n\n  _addEventListeners(){\n    const eo = this._markerManager.createEventObservable('click', <any>this.overlayView)\n    const cs = eo.subscribe(() => this.handleTap())\n    this._observableSubscriptions.push(cs)\n  }\n}\n","import { NgModule } from \"@angular/core\"\nimport { CommonModule } from \"@angular/common\"\nimport { AgmOverlay } from \"./AgmOverlay.component\"\n\n@NgModule({\n  imports:[\n    CommonModule\n  ],\n  declarations: [ AgmOverlay ],\n  exports : [ AgmOverlay ],\n}) export class AgmOverlays {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}